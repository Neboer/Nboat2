extends ../template
include ../public/menu_maker
include ../public/libs_maker
include ../public/pagination_maker
block title_and_libs
    title edit article
    +make_scripts('jquery','popper','bootstrap','font_awesome')
    +make_css('bootstrap')


block page_menu
    - var vl = isAuthed? [1,2,3,4,6]:[1,2,3,4]
    +make_menu(vl,4)

block content
    h1#neboersboat
        | #{blog.title}
        .d-inline-block(style="font-size: x-large")
            each tag in blog.tags
                span.badge.badge-secondary= tag
            span.badge.badge-secondary
                span
                    i.fas.fa-eye= blog.views
    blockquote(style="padding: 15px;background: #eee;border-radius: 5px;")= blog.description
    if isAuthed
        include big_toolbar
    img.d-block.m-auto.mw-100(src=blog.big_cover, alt="banner")
    a(href="#") 上一篇
    a.float-right(href="#") 下一篇
    article.markdown-body.entry-content.container-lg(itemprop="text")!= blog.article.find(article1 => article1.index === articleIndex).HTML

    - var article_href_list = blog.article.map(article => ("/blog/" + blog._id + "/" + article.index))

    +make_pagination(articleIndex, blog.article.length, article_href_list)

block append style_desktop
    .
        .fixed-width {
        width: 60px
        }


block scripts
    script.
        $("#toggle_visible").click(() => {
            $.ajax({
                type: "PUT",
                url: "/api/#{blog._id}/visibility",
                contentType: "application/json",
                data: JSON.stringify({"visible": #{!blog.visible}}),
                success: () => window.location.href = "/blog/#{blog._id}/#{articleIndex}",
                error: (jqxhr, status) => alert(status)
            });
        })

        $("#remove_current").click(() => {
            $.ajax({
                type: "DELETE",
                url: "/api/#{blog._id}/#{articleIndex}",
                success: () => console.log('successful'),
                error: (jqxhr, status) => alert(status)
            })
        })

        $("#delete").click(() => {
            $.ajax({
                type: "DELETE",
                url: "/api/#{blog._id}",
                success: () => console.log('successful'),
                error: (jqxhr, status) => alert(status)
            })
        })